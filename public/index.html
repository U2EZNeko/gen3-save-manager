<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=1200, initial-scale=1.0">
    <title>Gen3 Pokemon Viewer</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <header>
            <div class="header-content">
                <div class="header-text">
                    <h1>Gen3 Pokemon Viewer</h1>
                    <p class="subtitle">View and sort your .pk3 Pokemon files</p>
                </div>
                <button id="themeToggle" class="btn btn-secondary theme-toggle" title="Toggle light/dark mode">
                    <span id="themeIcon">ðŸŒ™</span>
                </button>
            </div>
        </header>

        <div class="controls-section">
            <!-- Section 1: Refresh Pokemon, DB Selector, Manage Folders, Card Width, Max Display -->
            <div class="controls-section-1">
                <div class="database-controls">
                    <button id="loadBtn" class="btn btn-primary">Refresh Pokemon</button>
                    <button id="pokedexBtn" class="btn btn-secondary">Pokedex</button>
                    <label for="databaseSelect">Database:</label>
                    <select id="databaseSelect" class="select">
                        <option value="db1">Database 1</option>
                        <option value="db2">Database 2</option>
                        <option value="db3">Database 3</option>
                        <option value="db4">Database 4</option>
                    </select>
                    <button id="manageFoldersBtn" class="btn btn-secondary" title="Manage folders">Manage Folders</button>
                </div>
                <div class="size-limit-controls">
                    <div class="size-controls">
                        <label for="cardWidthSlider">
                            Card width:
                            <span id="cardWidthValue">280px</span>
                        </label>
                        <input
                            type="range"
                            id="cardWidthSlider"
                            min="220"
                            max="700"
                            value="280"
                            step="10"
                        >
                    </div>
                    <div class="limit-controls">
                        <label for="maxDisplayLimit">
                            Max display:
                        </label>
                        <input
                            type="number"
                            id="maxDisplayLimit"
                            min="0"
                            max="10000"
                            value="50"
                            step="10"
                            placeholder="0 = unlimited"
                        >
                    </div>
                </div>
            </div>

            <!-- Section 2: DB Statistics -->
            <div class="controls-section-2">
                <div class="db-statistics">
                    <h3>Database Statistics</h3>
                    <div id="dbStatsDisplay" class="db-stats-content">
                        <div class="stat-item">
                            <span class="stat-label">Total Pokemon:</span>
                            <span id="statTotal" class="stat-value">-</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">Unique Species:</span>
                            <span id="statSpecies" class="stat-value">-</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">Shiny:</span>
                            <span id="statShiny" class="stat-value">-</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">Avg IV Sum:</span>
                            <span id="statIVSum" class="stat-value">-</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Section 3: Sort By, Search bar, Start Selecting, Statistics, Advanced options, and 4 checkboxes -->
            <div class="controls-section-3">
                <div class="sort-search-controls">
                    <div class="sort-controls">
                        <label for="sortSelect">Sort by:</label>
                        <select id="sortSelect" class="select">
                            <option value="ivSum">IV Sum (High to Low)</option>
                            <option value="ivSumAsc">IV Sum (Low to High)</option>
                            <option value="evSum">EV Sum (High to Low)</option>
                            <option value="evSumAsc">EV Sum (Low to High)</option>
                            <option value="species">Species</option>
                            <option value="nationalDex">National Dex Number</option>
                            <option value="level">Level (High to Low)</option>
                            <option value="levelAsc">Level (Low to High)</option>
                            <option value="hp">HP Stat (High to Low)</option>
                            <option value="attack">Attack Stat (High to Low)</option>
                            <option value="defense">Defense Stat (High to Low)</option>
                            <option value="spAttack">Sp. Attack Stat (High to Low)</option>
                            <option value="spDefense">Sp. Defense Stat (High to Low)</option>
                            <option value="speed">Speed Stat (High to Low)</option>
                            <option value="ivHp">IV HP (High to Low)</option>
                            <option value="ivAttack">IV Attack (High to Low)</option>
                            <option value="ivDefense">IV Defense (High to Low)</option>
                            <option value="ivSpAttack">IV Sp. Attack (High to Low)</option>
                            <option value="ivSpDefense">IV Sp. Defense (High to Low)</option>
                            <option value="ivSpeed">IV Speed (High to Low)</option>
                            <option value="experience">Experience (High to Low)</option>
                            <option value="tidSid">OT Name / Origin Game</option>
                            <option value="filename">Filename</option>
                            <option value="dateNewest">Date (Newest First)</option>
                            <option value="dateOldest">Date (Oldest First)</option>
                        </select>
                    </div>
                    <div class="filter-controls">
                        <input type="text" id="searchInput" class="search-input" placeholder="Search by species or nickname...">
                    </div>
                </div>
                <div class="action-controls">
                    <button id="startSelectingBtn" class="btn btn-secondary">Start Selecting</button>
                    <button id="downloadSelectedBtn" class="btn btn-primary hidden">Download Selected</button>
                    <button id="statisticsBtn" class="btn btn-secondary">Statistics</button>
                    <button id="advancedFilterBtn" class="btn btn-secondary">Advanced Filters</button>
                    <button id="advancedOptionsBtn" class="btn btn-secondary">Advanced Options</button>
                </div>
                <div class="checkbox-controls">
                    <div class="group-controls">
                        <label>
                            <input type="checkbox" id="groupByOT" class="checkbox">
                            Group by OT
                        </label>
                        <label>
                            <input type="checkbox" id="groupByTIDSID" class="checkbox">
                            Group by TID/SID
                        </label>
                        <label>
                            <input type="checkbox" id="needsEvolutionFilter" class="checkbox">
                            Needs Evolution (Missing from Dex)
                        </label>
                    </div>
                    <div class="filter-controls">
                        <label>
                            <input type="checkbox" id="shinyFilter" class="checkbox">
                            Show Only Shiny
                        </label>
                        <label>
                            <input type="checkbox" id="onePerSpeciesFilter" class="checkbox">
                            One Per Species (Highest IV)
                        </label>
                        <label>
                            <input type="checkbox" id="onePerSpeciesLowestFilter" class="checkbox">
                            One Per Species (Lowest IV)
                        </label>
                        <label>
                            <input type="checkbox" id="compactView" class="checkbox">
                            Compact View
                        </label>
                    </div>
                </div>
            </div>
        </div>

        <!-- Save File Management -->
        <div id="saveFileSection" class="save-file-section hidden">
            <div class="save-file-header">
                <h3>Save File Manager</h3>
                <span id="saveFileStatus" class="save-file-status">No save file loaded</span>
                <span class="save-file-close" id="closeSaveFileSection">&times;</span>
            </div>
            <div id="saveFileLoading" class="save-file-loading hidden">
                <div class="spinner"></div>
                <p>Loading save file...</p>
            </div>
            <div class="save-file-controls">
                <input type="file" id="saveFileInput" accept=".sav" style="display: none;">
                <button id="loadSaveFileBtn" class="btn btn-primary">Load Save File</button>
                <button id="sortBoxesBtn" class="btn btn-secondary" disabled>Sort Boxes by National Dex</button>
                <button id="exportSaveBtn" class="btn btn-primary" disabled>Export Save File</button>
                <div class="import-options">
                    <div class="import-target-options">
                        <label>
                            <input type="radio" name="importTarget" value="box" checked>
                            Import to Box (auto-find empty slots)
                        </label>
                        <label>
                            <input type="radio" name="importTarget" value="party">
                            Import to Party (auto-find empty slots)
                        </label>
                    </div>
                    <div class="import-special-options">
                        <button id="lotterySelectBtn" class="btn btn-secondary">Lottery Select (1 per TID/SID)</button>
                        <button id="livingDexBtn" class="btn btn-secondary">Living Dex Mode</button>
                        <label>
                            <input type="checkbox" id="startFromLastBox">
                            Start from Last Box
                        </label>
                    </div>
                </div>
                <div class="selected-pokemon-info">
                    <p id="selectedCount">0 Pokemon selected</p>
                    <button id="importSelectedBtn" class="btn btn-primary" disabled>Import Selected Pokemon</button>
                </div>
            </div>
        </div>

        <div id="loading" class="loading hidden">
            <div class="spinner"></div>
            <p>Loading Pokemon...</p>
        </div>

        <div id="error" class="error hidden"></div>

        <!-- Database Reload Notification -->
        <div id="dbReloadNotification" class="db-reload-notification hidden">
            <div class="notification-content">
                <span class="notification-icon">ðŸ“¦</span>
                <div class="notification-text">
                    <strong>New files detected!</strong>
                    <span id="notificationMessage">Files have been moved to your database. Reload to see them.</span>
                </div>
                <div class="notification-actions">
                    <button id="reloadDbBtn" class="btn btn-primary btn-small">Reload Database</button>
                    <button id="dismissNotificationBtn" class="btn btn-secondary btn-small">Dismiss</button>
                </div>
            </div>
        </div>

        <div id="stats" class="stats hidden">
            <span id="pokemonCount">0</span> Pokemon loaded
            <span id="filteredCount" class="filtered-count"></span>
        </div>

        <div id="pokemonGrid" class="pokemon-grid"></div>
    </div>

    <!-- Duplicate Scanner Results Modal -->
    <div id="duplicateResults" class="modal hidden">
        <div class="modal-content duplicate-results-content">
            <span class="modal-close" id="closeDuplicateResults">&times;</span>
            <h2>Duplicate Scanner Results</h2>
            <div id="duplicateResultsBody"></div>
        </div>
    </div>

    <!-- Advanced Filter Panel -->
    <div id="advancedFilterPanel" class="advanced-filter-panel hidden">
        <div class="advanced-filter-header">
            <h3>Advanced Filters</h3>
            <span class="modal-close" id="closeAdvancedFilters">&times;</span>
        </div>
        <div class="advanced-filter-body">
            <div class="filter-group">
                <h4>IV Filters</h4>
                <div class="filter-row">
                    <label>IV Sum Min:</label>
                    <input type="number" id="ivSumMin" min="0" max="186" class="filter-input">
                    <label>IV Sum Max:</label>
                    <input type="number" id="ivSumMax" min="0" max="186" class="filter-input">
                </div>
                <div class="filter-row">
                    <label>HP IV Min:</label>
                    <input type="number" id="ivHpMin" min="0" max="31" class="filter-input">
                    <label>HP IV Max:</label>
                    <input type="number" id="ivHpMax" min="0" max="31" class="filter-input">
                </div>
                <div class="filter-row">
                    <label>Attack IV Min:</label>
                    <input type="number" id="ivAttackMin" min="0" max="31" class="filter-input">
                    <label>Attack IV Max:</label>
                    <input type="number" id="ivAttackMax" min="0" max="31" class="filter-input">
                </div>
                <div class="filter-row">
                    <label>Defense IV Min:</label>
                    <input type="number" id="ivDefenseMin" min="0" max="31" class="filter-input">
                    <label>Defense IV Max:</label>
                    <input type="number" id="ivDefenseMax" min="0" max="31" class="filter-input">
                </div>
                <div class="filter-row">
                    <label>Sp. Attack IV Min:</label>
                    <input type="number" id="ivSpAttackMin" min="0" max="31" class="filter-input">
                    <label>Sp. Attack IV Max:</label>
                    <input type="number" id="ivSpAttackMax" min="0" max="31" class="filter-input">
                </div>
                <div class="filter-row">
                    <label>Sp. Defense IV Min:</label>
                    <input type="number" id="ivSpDefenseMin" min="0" max="31" class="filter-input">
                    <label>Sp. Defense IV Max:</label>
                    <input type="number" id="ivSpDefenseMax" min="0" max="31" class="filter-input">
                </div>
                <div class="filter-row">
                    <label>Speed IV Min:</label>
                    <input type="number" id="ivSpeedMin" min="0" max="31" class="filter-input">
                    <label>Speed IV Max:</label>
                    <input type="number" id="ivSpeedMax" min="0" max="31" class="filter-input">
                </div>
            </div>

            <div class="filter-group">
                <h4>EV Filters</h4>
                <div class="filter-row">
                    <label>EV Sum Min:</label>
                    <input type="number" id="evSumMin" min="0" max="510" class="filter-input">
                    <label>EV Sum Max:</label>
                    <input type="number" id="evSumMax" min="0" max="510" class="filter-input">
                </div>
            </div>

            <div class="filter-group">
                <h4>Level & Stats</h4>
                <div class="filter-row">
                    <label>Level Min:</label>
                    <input type="number" id="levelMin" min="1" max="100" class="filter-input">
                    <label>Level Max:</label>
                    <input type="number" id="levelMax" min="1" max="100" class="filter-input">
                </div>
                <div class="filter-row">
                    <label>HP Stat Min:</label>
                    <input type="number" id="hpStatMin" min="1" class="filter-input">
                    <label>HP Stat Max:</label>
                    <input type="number" id="hpStatMax" min="1" class="filter-input">
                </div>
            </div>

            <div class="filter-group">
                <h4>Nature</h4>
                <select id="natureFilter" class="filter-select" multiple>
                    <option value="Hardy">Hardy</option>
                    <option value="Lonely">Lonely</option>
                    <option value="Brave">Brave</option>
                    <option value="Adamant">Adamant</option>
                    <option value="Naughty">Naughty</option>
                    <option value="Bold">Bold</option>
                    <option value="Docile">Docile</option>
                    <option value="Relaxed">Relaxed</option>
                    <option value="Impish">Impish</option>
                    <option value="Lax">Lax</option>
                    <option value="Timid">Timid</option>
                    <option value="Hasty">Hasty</option>
                    <option value="Serious">Serious</option>
                    <option value="Jolly">Jolly</option>
                    <option value="Naive">Naive</option>
                    <option value="Modest">Modest</option>
                    <option value="Mild">Mild</option>
                    <option value="Quiet">Quiet</option>
                    <option value="Bashful">Bashful</option>
                    <option value="Rash">Rash</option>
                    <option value="Calm">Calm</option>
                    <option value="Gentle">Gentle</option>
                    <option value="Sassy">Sassy</option>
                    <option value="Careful">Careful</option>
                    <option value="Quirky">Quirky</option>
                </select>
            </div>

            <div class="filter-group">
                <h4>Origin Game</h4>
                <select id="originGameFilter" class="filter-select" multiple>
                    <optgroup label="Generation 3">
                        <option value="Ruby">Ruby</option>
                        <option value="Sapphire">Sapphire</option>
                        <option value="Emerald">Emerald</option>
                        <option value="FireRed">FireRed</option>
                        <option value="LeafGreen">LeafGreen</option>
                    </optgroup>
                    <optgroup label="Generation 4">
                        <option value="Diamond">Diamond</option>
                        <option value="Pearl">Pearl</option>
                        <option value="Platinum">Platinum</option>
                        <option value="HeartGold">HeartGold</option>
                        <option value="SoulSilver">SoulSilver</option>
                    </optgroup>
                    <optgroup label="Generation 5">
                        <option value="Black">Black</option>
                        <option value="White">White</option>
                        <option value="Black 2">Black 2</option>
                        <option value="White 2">White 2</option>
                    </optgroup>
                    <optgroup label="Generation 6">
                        <option value="X">X</option>
                        <option value="Y">Y</option>
                        <option value="Omega Ruby">Omega Ruby</option>
                        <option value="Alpha Sapphire">Alpha Sapphire</option>
                        <option value="Channel">Channel</option>
                        <option value="GO">GO</option>
                    </optgroup>
                    <optgroup label="Generation 7">
                        <option value="Sun">Sun</option>
                        <option value="Moon">Moon</option>
                        <option value="Ultra Sun">Ultra Sun</option>
                        <option value="Ultra Moon">Ultra Moon</option>
                    </optgroup>
                    <optgroup label="Let's Go">
                        <option value="Let's Go Pikachu">Let's Go Pikachu</option>
                        <option value="Let's Go Eevee">Let's Go Eevee</option>
                    </optgroup>
                    <optgroup label="Virtual Console">
                        <option value="Red">Red</option>
                        <option value="Blue">Blue</option>
                        <option value="Yellow">Yellow</option>
                        <option value="Gold">Gold</option>
                        <option value="Silver">Silver</option>
                        <option value="Crystal">Crystal</option>
                    </optgroup>
                </select>
            </div>

            <div class="filter-group">
                <h4>Ball Type</h4>
                <select id="ballFilter" class="filter-select" multiple>
                    <option value="Master Ball">Master Ball</option>
                    <option value="Ultra Ball">Ultra Ball</option>
                    <option value="Great Ball">Great Ball</option>
                    <option value="PokÃ© Ball">PokÃ© Ball</option>
                    <option value="Safari Ball">Safari Ball</option>
                    <option value="Net Ball">Net Ball</option>
                    <option value="Dive Ball">Dive Ball</option>
                    <option value="Nest Ball">Nest Ball</option>
                    <option value="Repeat Ball">Repeat Ball</option>
                    <option value="Timer Ball">Timer Ball</option>
                    <option value="Luxury Ball">Luxury Ball</option>
                    <option value="Premier Ball">Premier Ball</option>
                    <option value="Dusk Ball">Dusk Ball</option>
                    <option value="Heal Ball">Heal Ball</option>
                    <option value="Quick Ball">Quick Ball</option>
                    <option value="Cherish Ball">Cherish Ball</option>
                    <option value="Fast Ball">Fast Ball</option>
                    <option value="Level Ball">Level Ball</option>
                    <option value="Lure Ball">Lure Ball</option>
                    <option value="Heavy Ball">Heavy Ball</option>
                    <option value="Love Ball">Love Ball</option>
                    <option value="Friend Ball">Friend Ball</option>
                    <option value="Moon Ball">Moon Ball</option>
                    <option value="Sport Ball">Sport Ball</option>
                    <option value="Park Ball">Park Ball</option>
                    <option value="Dream Ball">Dream Ball</option>
                    <option value="Beast Ball">Beast Ball</option>
                </select>
            </div>

            <div class="filter-group">
                <h4>Location</h4>
                <div class="filter-row">
                    <label>Met Location:</label>
                    <input type="text" id="locationFilter" class="filter-input" placeholder="Filter by location name...">
                </div>
            </div>

            <div class="filter-group">
                <h4>Other Filters</h4>
                <div class="filter-row">
                    <label>
                        <input type="checkbox" id="filterShiny" class="checkbox">
                        Shiny Only
                    </label>
                </div>
                <div class="filter-row">
                    <label>
                        <input type="checkbox" id="filterHasNickname" class="checkbox">
                        Has Nickname
                    </label>
                </div>
                <div class="filter-row">
                    <label>OT Name:</label>
                    <input type="text" id="otNameFilter" class="filter-input" placeholder="Filter by OT name...">
                </div>
                <div class="filter-row">
                    <label>TID Min:</label>
                    <input type="number" id="tidMin" min="0" class="filter-input">
                    <label>TID Max:</label>
                    <input type="number" id="tidMax" min="0" class="filter-input">
                </div>
            </div>

            <div class="filter-actions">
                <button id="applyAdvancedFilters" class="btn btn-primary">Apply Filters</button>
                <button id="clearAdvancedFilters" class="btn btn-secondary">Clear All</button>
            </div>
        </div>
    </div>

    <!-- Pokemon Detail Modal -->
    <div id="pokemonModal" class="modal hidden">
        <div class="modal-content">
            <span class="modal-close">&times;</span>
            <div id="modalBody"></div>
        </div>
    </div>

    <!-- Statistics Modal -->
    <div id="statisticsModal" class="modal hidden">
        <div class="modal-content statistics-content">
            <span class="modal-close" id="closeStatistics">&times;</span>
            <h2>Database Statistics</h2>
            <div id="statisticsBody"></div>
        </div>
    </div>

    <!-- Folder Management Modal -->
    <div id="folderManagementModal" class="modal hidden">
        <div class="modal-content folder-management-content">
            <span class="modal-close" id="closeFolderManagement">&times;</span>
            <h2>Manage Folders</h2>
            <div class="folder-management-body">
                <div class="folder-list-section">
                    <h3>Current Folders</h3>
                    <div id="folderList" class="folder-list"></div>
                </div>
                <div class="add-folder-section">
                    <h3>Add New Folder</h3>
                    <div class="add-folder-form">
                        <div class="form-group">
                            <label for="newFolderName">Folder Name:</label>
                            <input type="text" id="newFolderName" class="form-input" placeholder="e.g., Database 5">
                        </div>
                        <div class="form-group">
                            <label for="newFolderPath">Folder Path:</label>
                            <input type="text" id="newFolderPath" class="form-input" placeholder="e.g., pk3-files-5 (relative) or full path">
                            <small class="form-hint">Enter a relative path (e.g., pk3-files-5) or an absolute path</small>
                        </div>
                        <button id="addFolderBtn" class="btn btn-primary">Add Folder</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Advanced Options Modal -->
    <div id="advancedOptionsModal" class="modal hidden">
        <div class="modal-content advanced-options-content">
            <span class="modal-close" id="closeAdvancedOptions">&times;</span>
            <h2>Advanced Options</h2>
            <div class="advanced-options-body">
                <div class="advanced-option-section">
                    <h3>Theme Options</h3>
                    <div class="theme-options">
                        <div class="form-group">
                            <label for="accentColorPicker">Accent Color:</label>
                            <div class="color-picker-group">
                                <input type="color" id="accentColorPicker" class="color-picker" value="#667eea">
                                <input type="text" id="accentColorText" class="color-text-input" value="#667eea" pattern="^#[0-9A-Fa-f]{6}$">
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Dark Mode:</label>
                            <div class="radio-group">
                                <label>
                                    <input type="radio" name="darkMode" value="light" class="radio">
                                    Light
                                </label>
                                <label>
                                    <input type="radio" name="darkMode" value="grey" class="radio">
                                    Grey Dark
                                </label>
                                <label>
                                    <input type="radio" name="darkMode" value="black" class="radio">
                                    Full Black Dark
                                </label>
                            </div>
                        </div>
                        <div class="form-group">
                            <label>IV Sum Bar Style:</label>
                            <div class="radio-group">
                                <label>
                                    <input type="radio" name="ivSumStyle" value="gradient" class="radio" checked>
                                    Gradient (Red to Green)
                                </label>
                                <label>
                                    <input type="radio" name="ivSumStyle" value="accent" class="radio">
                                    Accent Color
                                </label>
                            </div>
                            <small class="form-hint">Color IV Sum bars dynamically or use accent color</small>
                        </div>
                    </div>
                </div>
                
                <div class="advanced-option-section">
                    <h3>Quick Actions</h3>
                    <div class="quick-actions-grid">
                        <button id="duplicateScannerBtn" class="btn btn-secondary">Scan Duplicates</button>
                        <button id="loadSaveBtn" class="btn btn-secondary">Load Save File</button>
                        <button id="batchEvolveBtn" class="btn btn-secondary">Batch Evolve</button>
                    </div>
                </div>
                
                <div class="advanced-option-section">
                    <h3>Folder Scanner</h3>
                    <p class="option-description">Recursively scan a folder for .pk3 files and move them to a selected database. Files with the same name will be renamed automatically if they differ.</p>
                    <div class="scanner-form">
                        <div class="form-group">
                            <label for="scanSourceFolder">Source Folder:</label>
                            <input type="text" id="scanSourceFolder" class="form-input" placeholder="e.g., C:\Pokemon\Saves or ./saves (relative path)">
                            <small class="form-hint">Enter the folder path to scan recursively for .pk3 files</small>
                        </div>
                        <div class="form-group">
                            <label for="scanTargetDb">Target Database:</label>
                            <select id="scanTargetDb" class="form-input">
                                <option value="">Select a database...</option>
                            </select>
                            <small class="form-hint">Select the database where files will be moved</small>
                        </div>
                        <div class="form-group">
                            <label>
                                <input type="checkbox" id="enableAutoScan" class="checkbox">
                                Enable automatic scanning
                            </label>
                            <small class="form-hint">Automatically scan and move files at regular intervals</small>
                        </div>
                        <div class="form-group" id="scanIntervalGroup" style="display: none;">
                            <label for="scanInterval">Scan Interval (minutes):</label>
                            <input type="number" id="scanInterval" class="form-input" min="1" value="5" placeholder="5">
                            <small class="form-hint">How often to scan for new files (minimum 1 minute)</small>
                        </div>
                        <div class="scanner-actions">
                            <button id="saveScannerConfigBtn" class="btn btn-secondary">Save Configuration</button>
                            <button id="scanAndMoveBtn" class="btn btn-primary">Scan and Move Files</button>
                            <button id="stopAutoScanBtn" class="btn btn-danger" style="display: none;">Stop Auto-Scan</button>
                        </div>
                        <div id="scanStatus" class="scan-status hidden"></div>
                        <div id="scanResults" class="scan-results hidden"></div>
                    </div>
                </div>
                
                <div class="advanced-option-section">
                    <h3>Safari Zone Ball Fixer</h3>
                    <p class="option-description">Find Pokemon caught in Safari Zone locations that are not in a Safari Ball. Select them and replace with Safari Ball.</p>
                    <div class="safari-fixer-controls">
                        <button id="findSafariPokemonBtn" class="btn btn-secondary">Find Safari Zone Pokemon</button>
                        <div id="safariPokemonList" class="safari-pokemon-list hidden"></div>
                        <div id="safariFixerActions" class="safari-fixer-actions hidden">
                            <div class="safari-fixer-selection-controls">
                                <button id="selectAllSafariBtn" class="btn btn-secondary">Select All</button>
                                <button id="deselectAllSafariBtn" class="btn btn-secondary">Deselect All</button>
                            </div>
                            <p id="safariSelectedCount">0 Pokemon selected</p>
                            <button id="replaceSafariBallBtn" class="btn btn-primary" disabled>Replace with Safari Ball</button>
                        </div>
                    </div>
                </div>
                
                <div class="advanced-option-section">
                    <h3>Invalid Moves Fixer</h3>
                    <p class="option-description">Find Pokemon with moves that are out of legal range (corrupted moves). Select them and fix by replacing with Tackle and empty moves.</p>
                    <div class="safari-fixer-controls">
                        <button id="findInvalidMovesBtn" class="btn btn-secondary">Find Pokemon with Invalid Moves</button>
                        <div id="invalidMovesList" class="safari-pokemon-list hidden"></div>
                        <div id="invalidMovesActions" class="safari-fixer-actions hidden">
                            <div class="safari-fixer-selection-controls">
                                <button id="selectAllInvalidMovesBtn" class="btn btn-secondary">Select All</button>
                                <button id="deselectAllInvalidMovesBtn" class="btn btn-secondary">Deselect All</button>
                            </div>
                            <p id="invalidMovesSelectedCount">0 Pokemon selected</p>
                            <button id="fixInvalidMovesBtn" class="btn btn-primary" disabled>Fix Moves (Tackle + Empty)</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Batch Evolve Modal -->
    <div id="batchEvolveModal" class="modal hidden">
        <div class="modal-content" style="max-width: 900px;">
            <div class="modal-header">
                <h2>Batch Evolve</h2>
                <span class="modal-close" id="closeBatchEvolveModal">&times;</span>
            </div>
            <div class="modal-body">
                <p>Select Pokemon to evolve. Top 3 IV sum Pokemon per species are suggested.</p>
                <div style="margin: 10px 0;">
                    <button id="selectAllSuggestionsBtn" class="btn btn-secondary">Select All Suggestions</button>
                    <button id="deselectAllSuggestionsBtn" class="btn btn-secondary">Deselect All</button>
                    <span id="batchEvolveSelectedCount" style="margin-left: 10px;">0 selected</span>
                </div>
                <div id="batchEvolveSuggestions" style="max-height: 500px; overflow-y: auto;"></div>
                <div style="margin-top: 20px;">
                    <button id="executeBatchEvolveBtn" class="btn btn-primary" disabled>Evolve Selected</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Pokedex Modal -->
    <div id="pokedexModal" class="modal hidden">
        <div class="modal-content pokedex-modal">
            <div class="modal-header">
                <h2>Pokedex</h2>
                <span class="modal-close" id="closePokedexModal">&times;</span>
            </div>
            <div class="pokedex-content">
                <div class="pokedex-stats">
                    <h3>Living Dex Completion</h3>
                    <div id="pokedexCompletionStats"></div>
                </div>
                <div class="pokedex-filters">
                    <label>
                        <input type="checkbox" id="pokedexShowOwned" checked>
                        Show Owned
                    </label>
                    <label>
                        <input type="checkbox" id="pokedexShowMissing" checked>
                        Show Missing
                    </label>
                    <label>
                        <select id="pokedexGenFilter">
                            <option value="all">All Generations</option>
                            <option value="1">Generation 1</option>
                            <option value="2">Generation 2</option>
                            <option value="3">Generation 3</option>
                        </select>
                    </label>
                </div>
                <div id="pokedexGrid" class="pokedex-grid"></div>
            </div>
        </div>
    </div>

    <script src="app.js"></script>
</body>
</html>

